{"version":3,"sources":["hyperfiddle/electric/impl/io.cljc"],"mappings":"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","names":["cljs.core/PROTOCOL_SENTINEL","com.cognitect.transit.types/UUID","hyperfiddle.electric.impl.io/default-write-handler","cognitect.transit.write_handler","x","hyperfiddle.electric.impl.io/-last-unserializable-for-repl","js/console.log","cljs.core.pr_str","cljs.core/type","_","hyperfiddle.electric.impl.io/->cache","size","G__47726","arr47727","cljs.core/identity","cljs.core.object_array","hyperfiddle.electric.impl.io/cache-add","cache","k","v","i","cljs.core/count","cljs.core._EQ_","hyperfiddle.electric.impl.array-fields/get","arr47729","widx","p1__47728#","hyperfiddle.electric.impl.array-fields/getswap","cljs.core/mod","arr47730","hyperfiddle.electric.impl.io/cache-get","hyperfiddle.electric.impl.io/cache->map","ac","cljs.core/transient","cljs.core.assoc_BANG_","cljs.core/persistent!","hyperfiddle.electric.impl.io/!ex-cache","hyperfiddle.electric.impl.io/save-original-ex!","fi","id","hyperfiddle.electric.debug/ex-id","temp__5820__auto__","cause","cljs.core/ex-cause","js/hyperfiddle.electric.FailureInfo","hyperfiddle.electric.impl.io/get-original-ex","hyperfiddle.electric.impl.io/*write-handlers*","hyperfiddle.electric.impl.io/failure-writer","err","js/missionary.Cancelled","js/hyperfiddle.electric.Pending","js/hyperfiddle.electric.Remote","hyperfiddle.electric.debug/serializable","cljs.core/ex-data","cljs.core/ex-message","hyperfiddle.electric.impl.io/write-opts","cljs.core.merge","js/hyperfiddle.electric.Failure","hyperfiddle.electric.impl.io/*read-handlers*","hyperfiddle.electric.impl.io/failure-reader","cognitect.transit/read-handler","p__47745","vec__47746","seq__47747","cljs.core/seq","first__47748","cljs.core/first","cljs.core/next","tag","args","G__47749","cljs.core/Keyword","js/Error","vec__47752","cljs.core.nth","message","data","hyperfiddle.electric.debug.ex_info_STAR_","vec__47756","or__4998__auto__","hyperfiddle.electric.impl.io/read-opts","hyperfiddle.electric.impl.io/set-ints","cljs.core.partial","cljs.core/reduce-kv","r","n","offset","G__47762","hyperfiddle.electric.impl.io/encode-numbers","xs","required","G__47766","js/ArrayBuffer","js/DataView","hyperfiddle.electric.impl.io/decode-numbers","b","cljs.core/vec","hyperfiddle.electric.impl.io/t_hyperfiddle$electric$impl$io47768","rf","l","G__47777","G__47778","!cache","cljs.core.atom","hyperfiddle.electric.impl.io/transit-writer","cljs.core.swap_BANG_","p__47787","map__47788","cljs.core/--destructure-map","cljs.core.get","write-handlers","writer","cljs.core.assoc","cognitect.transit.writer","hyperfiddle.electric.impl.io/encode","cognitect.transit/write","hyperfiddle.electric.impl.io/transit-reader","p__47793","map__47794","read-handlers","reader","cognitect.transit.reader","hyperfiddle.electric.impl.io/decode","s","cognitect.transit/read","hyperfiddle.electric.impl.io/decode-str","e47802","G__47803","js/console.debug","t","cljs.core.ex_info","hyperfiddle.electric.impl.io/chunk-size","hyperfiddle.electric.impl.io/message-reader","?read","cr47805-state","cr47805-place-3","cr47805-block-2","missionary.core/park","cr47805-exception","e47897","cr47805-place-8","cr47805-place-10","cr47805-place-9","cr47805-place-28","cr47805-place-35","cr47805-place-36","cr47805-block-10","e47901","cr47805-place-4","cr47805-place-2","cr47805-place-37","cr47805-place-38","cr47805-place-39","cr47805-place-40","cr47805-place-41","cr47805-place-42","cr47805-block-1","e47917","cr47805-place-11","cr47805-place-12","cr47805-place-13","cljs.core/IVector","cr47805-place-14","cr47805-block-4","e47928","cr47805-place-29","cr47805-block-6","e47932","cr47805-place-22","cr47805-place-30","missionary.core/unpark","cr47805-place-31","e47937","cr47805-place-0","cr47805-place-1","e47938","cr47805-place-32","cr47805-place-33","cr47805-place-34","cr47805-block-8","e47941","cr47805-place-15","cr47805-place-16","cr47805-place-17","cr47805-place-18","cr47805-place-19","cr47805-place-20","cr47805-place-21","cr47805-place-23","cr47805-place-24","cr47805-place-25","cr47805-place-26","cr47805-place-27","cr47805-block-7","cr47805-block-5","e47946","cr47805-place-7","e47956","cr47805-place-5","cr47805-place-6","cr47805-block-9","cr47805-block-3","e47958","cloroutine.impl/coroutine","G__47959","cr47805-block-0","missionary.core/sp-run","G__47940","fexpr__47939","G__47921","G__47922","fexpr__47920","cljs.core/conj!","G__47919","fexpr__47918","G__47915","fexpr__47914","G__47907","G__47908","fexpr__47906","G__47931","fexpr__47930","G__47948","fexpr__47947","G__47950","G__47951","G__47952","fexpr__47949","cljs.core/reduce","G__47954","fexpr__47953","G__47944","fexpr__47943","p1__47960#","hyperfiddle.electric.impl.io/message-writer","write","cr47961-state","cr47961-place-21","cr47961-place-44","cr47961-place-45","cr47961-block-1","cr47961-exception","e48062","cr47961-place-54","cr47961-block-14","e48063","cr47961-place-20","cr47961-place-28","cr47961-place-29","cr47961-place-30","cr47961-block-5","e48064","cr47961-block-4","cr47961-place-48","cr47961-place-62","cr47961-place-63","cr47961-place-64","cr47961-place-65","cr47961-place-66","cr47961-place-67","cr47961-place-68","cr47961-place-69","cr47961-place-70","cr47961-place-71","cr47961-block-12","e48067","cr47961-place-4","cr47961-place-5","cr47961-place-6","cr47961-place-7","cr47961-place-8","cr47961-place-9","cr47961-block-7","cr47961-block-2","e48079","cr47961-place-55","cr47961-place-56","cr47961-place-57","cr47961-place-58","cr47961-place-59","cr47961-place-60","cr47961-block-10","e48080","cr47961-place-49","cr47961-place-50","cr47961-place-51","cr47961-place-52","cr47961-place-53","cr47961-block-11","cr47961-block-9","e48085","cr47961-place-0","cr47961-place-1","cr47961-place-2","cr47961-place-3","e48088","cr47961-place-72","cr47961-place-73","cr47961-place-74","cr47961-place-75","cr47961-place-76","cr47961-block-8","e48093","cr47961-place-10","cr47961-place-11","cr47961-place-12","cr47961-place-13","cr47961-place-14","cr47961-place-15","cr47961-place-16","cr47961-place-17","cr47961-place-18","cr47961-place-19","cr47961-place-22","cr47961-place-23","cr47961-place-24","cr47961-place-25","cr47961-place-26","cr47961-place-27","cr47961-block-3","e48097","cr47961-place-31","cr47961-place-32","cr47961-place-33","cr47961-place-34","cr47961-place-35","cr47961-place-36","cljs.core/IMap","cr47961-place-37","cr47961-place-38","cr47961-place-39","e48107","e48114","cr47961-place-40","cr47961-place-41","cr47961-place-42","cr47961-place-43","cr47961-block-6","e48116","cr47961-place-46","cr47961-place-47","e48120","cr47961-place-61","cr47961-block-13","e48123","G__48124","cr47961-block-0","G__48092","fexpr__48091","G__48090","fexpr__48089","cljs.core/pop","G__48099","fexpr__48098","G__48101","fexpr__48100","G__48103","fexpr__48102","G__48105","G__48106","fexpr__48104","G__48119","fexpr__48118","G__48066","fexpr__48065","G__48111","G__48112","G__48113","fexpr__48110","cljs.core/ex-info","G__48122","fexpr__48121","cljs.core/peek","G__48087","fexpr__48086","G__48078","fexpr__48077","G__48075","fexpr__48074","G__48070","G__48071","G__48072","fexpr__48069","cljs.core/subvec","G__48095","G__48096","fexpr__48094","G__48084","fexpr__48083","G__48082","fexpr__48081","hyperfiddle.electric.impl.io/decoder","G__48125","cljs.core.conj","cljs.core.into","hyperfiddle.electric.impl.io/encoder","cljs.core.reduce","cljs.core.eduction","cljs.core.map","cljs.core.partition_all","G__48126","G__48127","G__48128","var_args","G__48130","hyperfiddle.electric.impl.io/foreach"],"sourcesContent":[";; Facilities for encoding/decoding of Electric protocol messages.\r\n;; * Data frames can be arbitrary clojure data or Electric failures. Serialization is done via transit json, the failure\r\n;; error is preserved if it's an instance of `hyperfiddle.electric.Pending` or `hyperfiddle.electric.Cancelled`, otherwise\r\n;; the error is logged and turned into an instance of `hyperfiddle.electric.Remote`.\r\n;; * Control frames are vectors of signed integers. Serialization is the concatenation of the binary representation of\r\n;; these numbers as fixed-length 32-bit, big endian.\r\n\r\n(ns ^:no-doc hyperfiddle.electric.impl.io\r\n  (:require [missionary.core :as m]\r\n            [cognitect.transit :as t]\r\n            #?(:clj [clojure.tools.logging :as log])\r\n            [hyperfiddle.electric.debug :as dbg]\r\n            [hyperfiddle.rcf :as rcf :refer [tests with tap %]]\r\n            #?(:cljs [com.cognitect.transit.types])\r\n            [hyperfiddle.electric.impl.array-fields :as a])\r\n  (:import (missionary Cancelled)\r\n           (hyperfiddle.electric Failure Pending Remote FailureInfo)\r\n           #?(:clj (java.nio ByteBuffer))\r\n           #?(:clj (java.io ByteArrayInputStream ByteArrayOutputStream))\r\n           #?(:clj (clojure.lang IReduceInit))))\r\n\r\n#?(:cljs (extend-type com.cognitect.transit.types/UUID IUUID)) ; https://github.com/hyperfiddle/hyperfiddle/issues/728\r\n\r\n(def default-write-handler ; Intercepts unserializable values, logs and return nil\r\n  (t/write-handler ; Adapted from `com.cognitect.transit.impl.WriteHandlers.NullWriteHandler`\r\n    (fn [x]\r\n      (def -last-unserializable-for-repl x)\r\n      (#?(:clj log/info, :cljs js/console.log) \"Unserializable reference transfer:\" (pr-str (type x)) (str x))\r\n      \"_\")\r\n    (fn [x] nil)\r\n    (fn [_] \"\")))\r\n\r\n(defn ->cache \"Builds a minimal, cljc map/bounded-queue cache.\r\n  One slot per key (map).\r\n  Reaching `size` pops oldest value (bounded-queue).\" [size]\r\n  (doto (object-array (inc (* size 2))) (a/set (* size 2) 0)))\r\n(defn cache-add [cache k v]\r\n  (when-not (loop [i 0]\r\n              (when (< i (dec (count cache)))\r\n                (if (= k (a/get cache i))\r\n                  (do (a/set cache (inc i) v) true)\r\n                  (recur (+ i 2)))))\r\n    (let [widx (a/getswap cache (dec (count cache)) #(mod (+ % 2) (dec (count cache))))]\r\n      (a/set cache widx k, (inc widx) v))))\r\n(defn cache-get [cache k]\r\n  (loop [i 0]\r\n    (when (< i (dec (count cache)))\r\n      (if (= k (a/get cache i))\r\n        (a/get cache (inc i))\r\n        (recur (+ i 2))))))\r\n(defn cache->map [cache]\r\n  (loop [i 0, ac (transient {})]\r\n    (if (< i (dec (count cache)))\r\n      (recur (+ i 2) (assoc! ac (a/get cache i) (a/get cache (inc i))))\r\n      (persistent! ac))))\r\n\r\n(tests \"keyed cache\"\r\n  (def !c (->cache 1))\r\n  (cache-add !c 1 2) (cache-get !c 1) := 2\r\n  (cache-add !c 1 3) (cache-get !c 1) := 3\r\n  (cache-add !c 2 4) (cache-get !c 2) := 4\r\n  (cache->map !c) := {2 4}\r\n\r\n  \"size 2\"\r\n  (def !c (->cache 2))\r\n  (cache-add !c 1 1)\r\n  (cache-add !c 2 2)\r\n  (cache-add !c 2 2)\r\n  (cache->map !c) := {1 1, 2 2})\r\n\r\n(def !ex-cache (->cache 16))\r\n(defn save-original-ex! [fi]\r\n  (let [id (dbg/ex-id fi)]\r\n    (when-some [cause (ex-cause fi)]\r\n      (when-not (instance? FailureInfo cause)\r\n        (cache-add !ex-cache id cause)))\r\n    id))\r\n(defn get-original-ex [id] (cache-get !ex-cache id))\r\n\r\n(def ^:dynamic *write-handlers* nil)\r\n\r\n(def failure-writer (t/write-handler\r\n                      (fn [_] \"failure\")\r\n                      (fn [x]\r\n                        (let [err (.-error ^Failure x)]\r\n                          (cond (instance? Cancelled err) [:cancelled]\r\n                                (instance? Pending err)   [:pending]\r\n                                (instance? Remote err)    [:remote (dbg/serializable (ex-data err))]\r\n                                :else                     [:exception (ex-message err) (dbg/serializable (ex-data err))\r\n                                                           (save-original-ex! err)])))))\r\n\r\n(defn write-opts []\r\n  {:handlers (merge *write-handlers*\r\n               {Failure failure-writer\r\n                :default default-write-handler}) ; cljs\r\n   :default-handler default-write-handler}) ; clj\r\n\r\n(def ^:dynamic *read-handlers* nil)\r\n\r\n(def failure-reader (t/read-handler\r\n                      (fn [[tag & args]]\r\n                        (case tag\r\n                          :exception (let [[message data id] args]\r\n                                       (Failure. (dbg/ex-info* message data id nil)))\r\n                          :remote    (let [[data] args]\r\n                                       (Failure. (dbg/ex-info* \"Remote error\" (or data {}))))\r\n                          :pending   (Failure. (Pending.))\r\n                          :cancelled (Failure. (Cancelled.))))))\r\n\r\n(defn read-opts [] {:handlers (merge *read-handlers* {\"failure\" failure-reader})})\r\n\r\n(def set-ints\r\n  (partial reduce-kv\r\n    (fn [r i n]\r\n      (let [offset (bit-shift-left i 2)]\r\n        #?(:clj  (.putInt ^ByteBuffer r offset n)\r\n           :cljs (doto r (.setInt32 offset n)))))))\r\n\r\n(defn encode-numbers\r\n  \"Encode a control frame to a binary segment.\"\r\n  [xs]\r\n  (let [required (bit-shift-left (count xs) 2)] ; size of bytebuffer is 4 \u00d7 (count xs), so shift by 2\r\n    #?(:clj (set-ints (ByteBuffer/allocate required) xs)\r\n       :cljs (doto (js/ArrayBuffer. required)\r\n               (-> (js/DataView.) (set-ints xs))))))\r\n\r\n(defn decode-numbers\r\n  \"Decode a control frame from a binary segment.\"\r\n  [b]\r\n  (vec\r\n    (reify\r\n      #?(:clj IReduceInit :cljs IReduce)\r\n      #?(:clj (reduce [_ rf r]\r\n                (let [l (.limit ^ByteBuffer b)]\r\n                  (loop [r r, i (int 0)]\r\n                    (if (< i l)\r\n                      (recur (rf r (.getInt ^ByteBuffer b i))\r\n                        (unchecked-add-int i 4)) r))))\r\n         :cljs (-reduce [_ rf r]\r\n                 (let [l (.-byteLength b)\r\n                       v (js/DataView. b)]\r\n                   (loop [r r, i 0]\r\n                     (if (< i l)\r\n                       (recur (rf r (.getInt32 v i))\r\n                         (+ i 4)) r))))))))\r\n\r\n\r\n;; #?(:cljs (def transit-writer (t/writer :json (write-opts))))\r\n#?(:cljs (let [!cache (atom {:write-handlers *write-handlers*, :writer nil})]\r\n           (defn transit-writer []\r\n             (:writer (swap! !cache (fn [{:keys [write-handlers writer] :as cache}]\r\n                                      (if (= write-handlers *write-handlers*)\r\n                                        (if writer\r\n                                          cache\r\n                                          (assoc cache :writer (t/writer :json (write-opts))))\r\n                                        {:write-handlers *write-handlers*\r\n                                         :writer         (t/writer :json (write-opts))})))))))\r\n\r\n(defn encode\r\n  \"Encode a data frame to transit json\"\r\n  [x]\r\n  #?(:clj (let [out (ByteArrayOutputStream.)]\r\n            (t/write (t/writer out :json (write-opts)) x)\r\n            (.toString out))\r\n     :cljs (t/write (transit-writer) x)))\r\n\r\n;; #?(:cljs (def transit-reader (t/reader :json (read-opts))))\r\n#?(:cljs (let [!cache (atom {:read-handlers *read-handlers*, :reader nil})]\r\n           (defn transit-reader []\r\n             (:reader (swap! !cache (fn [{:keys [read-handlers reader] :as cache}]\r\n                                      (if (= read-handlers *read-handlers*)\r\n                                        (if reader\r\n                                          cache\r\n                                          (assoc cache :reader (t/reader :json (read-opts))))\r\n                                        {:read-handlers *read-handlers*\r\n                                         :reader        (t/reader :json (read-opts))})))))))\r\n\r\n\r\n(defn decode\r\n  \"Decode a data frame from transit json\"\r\n  [^String s]\r\n  #?(:clj (t/read (t/reader (ByteArrayInputStream. (.getBytes s \"UTF-8\")) :json (read-opts)))\r\n     :cljs (t/read (transit-reader) s)))\r\n\r\n(defn decode-str [x]\r\n  (try (doto (decode x) (->> (#?(:clj log/trace, :cljs js/console.debug) \"\ud83d\udd3d\")))\r\n    (catch #?(:clj Throwable :cljs :default) t\r\n      (throw (ex-info \"Failed to decode\" {:value x} t)))))\r\n\r\n(tests \"FailureInfo\"\r\n  (def cause (ex-info \"boom\" {}))\r\n  (def ex (dbg/ex-info* \"x\" {} cause))\r\n  (def sent (-> ex Failure. encode decode .-error))\r\n  \"keeps the ID across the wire\"\r\n  (dbg/ex-id ex) := (dbg/ex-id sent)\r\n  \"can restore cause\"\r\n  (get-original-ex (dbg/ex-id sent)) := cause\r\n  nil)\r\n\r\n; Jetty rejects websocket payloads larger than 65536 bytes by default\r\n; We\u2019ll chop messages if needed\r\n(def chunk-size (bit-shift-right 65536 2))\r\n\r\n(defn ^:deprecated message-reader [?read]\r\n  \"Returns a discrete flow of read Electric messages from provided task, emitting individual frames.\"\r\n  (m/sp\r\n    (loop [data (transient [])]\r\n      (let [x (m/? ?read)]\r\n        (if (string? x)\r\n          (recur (conj! data (decode-str x)))\r\n          (persistent!\r\n            (conj! data\r\n              (loop [x       x\r\n                     control (transient [])]\r\n                (let [xs      (decode-numbers x)\r\n                      control (reduce conj! control xs)]\r\n                  (if (< (count xs) chunk-size) ; final frame\r\n                    (persistent! control)\r\n                    (recur (m/? ?read) control)))))))))))\r\n\r\n\r\n(defn ^:deprecated message-writer\r\n  \"Returns a function taking an Electric message and returning a task writing it as individual frames using provided\r\n   function. Might cut a message into chunks if its size would exceed the server payload limit.\r\n   An empty message (0b) is written to notify the end of frame.\"\r\n  [write]\r\n  #(m/sp\r\n     (loop [xs (seq (pop %))]\r\n       (if-some [[x & xs] xs]\r\n         (do (#?(:clj log/trace, :cljs js/console.debug) \"\ud83d\udd3c\" x)\r\n           (m/? (write\r\n                  (try (encode x)\r\n                    (catch #?(:clj Throwable :cljs :default) t\r\n                      (throw (ex-info \"Failed to encode\" {:value x} t))))))\r\n           (recur xs))\r\n         (loop [xs (peek %)]\r\n           (if (>= (count xs) chunk-size)\r\n             (do (m/? (write (encode-numbers (subvec xs 0 chunk-size))))\r\n               (recur (subvec xs chunk-size)))\r\n             (m/? (write (encode-numbers xs)))))))))\r\n\r\n(defn ^:deprecated decoder\r\n  \"A transducer partitioning a sequence of network messages into Electric events.\"\r\n  [rf]\r\n  (let [data (doto (object-array 2)\r\n               (aset 0 []) (aset 1 []))]\r\n    (fn\r\n      ([] (rf))\r\n      ([r]\r\n       (assert (= [] (aget data 0) (aget data 1)))\r\n       (rf r))\r\n      ([r x]\r\n       (if (string? x)\r\n         (do (assert (= [] (aget data 1)))\r\n             (aset data 0 (conj (aget data 0) (decode-str x))) r)\r\n         (let [xs (decode-numbers x)]\r\n           (aset data 1 (into (aget data 1) xs))\r\n           (if (< (count xs) chunk-size)                  ; final frame\r\n             (let [x (conj (aget data 0) (aget data 1))]\r\n               (aset data 0 [])\r\n               (aset data 1 [])\r\n               (rf r x)) r)))))))\r\n\r\n(defn ^:deprecated encoder\r\n  \"A transducer expanding Electric events to a sequence of network messages.\"\r\n  [rf]\r\n  (fn\r\n    ([] (rf))\r\n    ([r] (rf r))\r\n    ([r x]\r\n     (let [r (reduce rf r (eduction (map encode) (pop x)))\r\n           r (reduce rf r (eduction (partition-all chunk-size) (map encode-numbers) (peek x)))]\r\n       (case (mod (count (peek x)) chunk-size)\r\n         0 (rf r (encode-numbers [])) r)))))\r\n\r\n(defn foreach\r\n  ([r] r)\r\n  ([r x] (r x) r))\r\n"],"x_google_ignoreList":[0]}