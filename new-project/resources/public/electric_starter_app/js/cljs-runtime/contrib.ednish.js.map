{"version":3,"sources":["contrib/ednish.cljc"],"mappings":";AAWA,uCAAA,2CAAA,IAAA,IAAA,KAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,/HAAKA;AAYL;;;;wBAAA,xBAAMC,wDAEHC;AAFH,AAGE,OAACC,+CAAO,aAAAC,FAAKG;AAAL,AAAA,IAAAF,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAAQG;QAAR,AAAAF,4CAAAD,WAAA,IAAA,/DAAUI;AAAV,AACE,OAACC,uBAAuBH,EAAEC,EAAEC;GAC9BP,QACAF;;AAEV,wBAAA,xBAAMW,wDAAQC;AAAd,AACE,OAACT,+CAAO,aAAAU,FAAKN;AAAL,AAAA,IAAAO,aAAAD;QAAA,AAAAP,4CAAAQ,WAAA,IAAA,/DAAQN;QAAR,AAAAF,4CAAAQ,WAAA,IAAA,/DAAUL;AAAV,AAAc,OAACC,uBAAuBH,EAAEC,EAAEC;GAC1CG,WACA,AAACG,uBAAuBf;;AAElC,AAQA,AAAKgB,4BAAW,AAACC,6CAAKC,6BAA6BjB,sBAAOkB;AAC1D,AAAKC,4BAAW,AAACH,6CAAKI,wBAAwBV,sBAAOW;AAErD,AAmBA,uCAAA,vCAAMC,sFAAuBC;AAA7B,AACE,GAAI,uCAAA,vCAACC,kCAA4BD;AAAU,yDAAA,lDAACE,6CAAKF;;AAAQA;;;AAE3D,6BAAA,7BAAMI,kEAAaJ,KAAKK;AAAxB,AAAA,GACU,OAASL;AADnB;AAAA,AAAA,MAAA,KAAAG,MAAA;;;AAAA,GACyB,GAAA,iBAAA,hBAAOE;AADhC;AAAA,AAAA,MAAA,KAAAF,MAAA;;;AAEG,GAAU,kDAAA,lDAACG,6CAAEN;AAAb;;AAAA,AACE,IAAMA,WAAK,AAACD,qCAAsBC;AAAlC,AACE,OAACJ,0BAAWI","names":["contrib.ednish/-edn-dialect-mappings","contrib.ednish/encode","edn-str","cljs.core.reduce","p__34737","vec__34738","cljs.core.nth","a","k","v","clojure.string/replace","contrib.ednish/decode","ednish-str","p__34741","vec__34742","clojure.set/map-invert","contrib.ednish/encode-uri","cljs.core.comp","contrib.rfc3986/encode-pchar","cljs.core/pr-str","contrib.ednish/decode-uri","clojure.edn/read-string","contrib.rfc3986/decode-pchar","contrib.ednish/discard-leading-slash","path","clojure.string/starts-with?","cljs.core.subs","js/Error","contrib.ednish/decode-path","read-edn-str","cljs.core._EQ_"],"sourcesContent":["(ns contrib.ednish\r\n  (:require clojure.set\r\n            clojure.string\r\n            clojure.edn\r\n            contrib.rfc3986\r\n            [hyperfiddle.rcf :refer [tests]]))\r\n\r\n; https://tools.ietf.org/html/rfc2396#section-2.4.3\r\n;\r\n; unwise = \"{\" | \"}\" | \"|\" | \"\\\" | \"^\" | \"[\" | \"]\" | \"`\"\r\n\r\n(def -edn-dialect-mappings\r\n  {\\space \\,\r\n   \\\" \\'\r\n   \\# \\~\r\n   \\/ \\!\r\n   ;\\{ \\( \\} \\)\r\n   \\[ \\( \\] \\)\r\n   })\r\n\r\n; Paste this into chrome and it will display properly\r\n; https://ko.wikipedia.org/wiki/%EC%9C%84%ED%82%A4%EB%B0%B1%EA%B3%BC:%EB%8C%80%EB%AC%B8\r\n\r\n(defn encode \"Re-encode an edn-string to url-safe dialect of edn-ish. Vectors, sets and maps\r\ncoalesce into lists and are not disambiguated.\"\r\n  [edn-str]\r\n  (reduce (fn [a [k v]]\r\n            (clojure.string/replace a k v))\r\n          edn-str\r\n          -edn-dialect-mappings))\r\n\r\n(defn decode [ednish-str]\r\n  (reduce (fn [a [k v]] (clojure.string/replace a k v))\r\n          ednish-str\r\n          (clojure.set/map-invert -edn-dialect-mappings)))\r\n\r\n(tests\r\n  (encode (pr-str :hyperfiddle.blog/post)) := \":hyperfiddle.blog!post\"\r\n  (encode (pr-str :a!b)) := \":a!b\"\r\n  (encode (pr-str \"kobe\")) := \"'kobe'\"\r\n  (encode (pr-str #{\"events\" \"news\"})) := \"~{'news','events'}\"\r\n  (encode (pr-str #uuid \"07655f77-608d-472b-bc5e-86fcecc40b00\"))\r\n  := \"~uuid,'07655f77-608d-472b-bc5e-86fcecc40b00'\")\r\n\r\n(def encode-uri (comp contrib.rfc3986/encode-pchar encode pr-str))\r\n(def decode-uri (comp clojure.edn/read-string decode contrib.rfc3986/decode-pchar))\r\n\r\n(tests\r\n  \"url encoding\"\r\n  (encode-uri \"|\") := \"'%7C'\"\r\n  (decode-uri \"'%7C'\") := \"|\"\r\n\r\n  (encode-uri \"!$&'[]()*+,;=|\") := \"'!$&'()()*+,;=%7C'\"\r\n  ;(decode-uri \"'!$&'()()*+,;=%7C'\") := \"!$&'()()*+,;=|\" -- todo why broken?\r\n  )\r\n\r\n;(tests -- No reader function for tag uri -- this test passes in hf-2020\r\n;  \"ednish-tunneling\"\r\n;  (def v #uri \"datomic:free://datomic:4334/~dustin.getz\")\r\n;  (def encoded (encode-ednish (pr-str v)))\r\n;  (pr-str v) := _\r\n;  (encode-ednish (pr-str v)) := \"~uri,'datomic:free:!!datomic:4334!~dustin.getz'\"\r\n;  ;(is (= (decode-ednish encoded) (pr-str v)))\r\n;  ; \"#uri \\\"datomic:free://datomic:4334/#dustin.getz\\\"\"\r\n;  )\r\n\r\n(defn discard-leading-slash [path]\r\n  (if (clojure.string/starts-with? path \"/\") (subs path 1) path))\r\n\r\n(defn decode-path [path read-edn-str]\r\n   {:pre [(string? path) (some? read-edn-str)]}\r\n   (when-not (= path \"/\")\r\n     (let [path (discard-leading-slash path)]\r\n       (decode-uri path))))\r\n"],"x_google_ignoreList":[0]}