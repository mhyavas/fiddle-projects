{"version":3,"sources":["contrib/rfc3986.cljc"],"mappings":";AAYA,8BAAA,kFAAA,SAAA,SAAA,SAAA,SAAA,SAAA,SAAA,SAAA,SAAA,SAAA,SAAA,1MAAKA;AACL,AAAKC,8BAAY,2SAAA,iFAAA,SAAA,SAAA,SAAA,vZAACC,uDAAkB,AAACC,cAAI,4DAAA,5DAACC,4CAAIC,+CACV,AAACF,cAAI,4DAAA,5DAACC,4CAAIC;AAE9C,AAAKC,yBAAO,iKAAA,iFAAA,SAAA,3PAACJ,uDAAkBD,4BAAYD;AAE3C;;;;;+BAAA,/BAAMO,sEAIHC;AAJH,yDAMO,AAACJ,4CAAI,WAAKK,hHAIV,OAACE;AAJI,AACE,oBAAI,CAACL,uDAAAA,0DAAAA,LAAOG,sCAAAA;AACVA;;AACA,QAAA,IAAS,AAACC,+BAAcD;;GAJjCD;;AAOP,+BAAA,/BAAMI,sEAAcJ;AAApB,AACE,yDAAI,2BAAA,VAAOe,nEAOPZ;IAPAE,WACgBL;IADhBM,aAAAD;IAAAE,aAAA,AAAAC,cAAAF;IAAAG,eAAA,AAAAC,gBAAAH;IAAAA,iBAAA,AAAAI,eAAAJ;QAAAE,JACQR;SADRM,LACYS;AADZ,AAAA,IAAOD,cAAAA;IAAPV,eAAAA;;AAAA,AAAA,IAAOU,cAAAA;IAAPH,aAAAP;IAAAQ,aAAA,AAAAL,cAAAI;IAAAE,eAAA,AAAAJ,gBAAAG;IAAAA,iBAAA,AAAAF,eAAAE;YAAAC,RACQb;aADRY,TACYG;AADZ,AAEE,GAAA,AAAAC,cAAQhB;AACNc;;AACA,GAAI,6CAAA,7CAACG,kDAAK,AAACC,wBAAUlB;AACnB,eAAO,AAACmB,6CAAKL,YAAQ,AAACM,+BAAc,AAAClB,kDAAY,6CAAA,7CAACmB,iDAAON;eAAO,6CAAA,7CAACO,iDAAOP;;;;;AACxE,eAAO,AAACI,6CAAKL,YAAQd;eAAGe;;;;;;;;;;AAGpC","names":["contrib.rfc3986/-sub-delims","contrib.rfc3986/-unreserved","clojure.set.union","cljs.core/set","cljs.core.map","cljs.core/char","contrib.rfc3986/-pchar","contrib.rfc3986/encode-pchar","s","c","contrib.char$/char->hex-str","clojure.string.join","contrib.rfc3986/decode-pchar","G__34495","vec__34496","seq__34497","cljs.core/seq","first__34498","cljs.core/first","cljs.core/next","vec__34529","seq__34530","first__34531","decoded","ss","cljs.core/not","cljs.core._EQ_","contrib.char$/char-code","cljs.core.conj","contrib.char$/hex-str->char","cljs.core.take","cljs.core.drop"],"sourcesContent":["(ns contrib.rfc3986\r\n  (:require clojure.set\r\n            [clojure.string :as string]\r\n            [contrib.char$ :refer [char-code char->hex-str hex-str->char]]\r\n            [hyperfiddle.rcf :refer [tests]]))\r\n\r\n; https://tools.ietf.org/html/rfc3986#appendix-A\r\n;\r\n; pchar         = unreserved / pct-encoded / sub-delims / \":\" / \"@\"\r\n; unreserved    = ALPHA / DIGIT / \"-\" / \".\" / \"_\" / \"~\"\r\n; sub-delims    = \"!\" / \"$\" / \"&\" / \"'\" / \"(\" / \")\" / \"*\" / \"+\" / \",\" / \";\" / \"=\"\r\n\r\n(def -sub-delims #{\\! \\$ \\& \\' \\( \\) \\* \\+ \\, \\; \\=})\r\n(def -unreserved (clojure.set/union (set (map char \"abcdefghijklmnopqrstuvwxyz\"))\r\n                                    (set (map char \"0123456789\"))\r\n                                    #{\\- \\. \\_ \\~}))\r\n(def -pchar (clojure.set/union -unreserved -sub-delims #{\\: \\@}))\r\n\r\n(defn encode-pchar\r\n  \"percent-encode a url path segment without over-encoding (which many platform url decoders do).\r\n  Notably, this impl is compatible with java.net.URI which fails on some chars in the 'unwise set',\r\n  which are probably safe today.\"\r\n  [s]\r\n  (->> s\r\n       (map (fn [c]\r\n              (if (-pchar c) ; whitelist\r\n                c\r\n                (str \"%\" (char->hex-str c)))))\r\n       (string/join)))\r\n\r\n(defn decode-pchar [s]\r\n  (-> (loop [decoded []\r\n             [c & ss] s]\r\n        (if-not c\r\n          decoded ; done\r\n          (if (= 37 (char-code c)) ; 37 is \\% written portably\r\n            (recur (conj decoded (hex-str->char (string/join (take 2 ss)))) (drop 2 ss))\r\n            (recur (conj decoded c) ss))))\r\n      string/join))\r\n\r\n(tests\r\n  \"pchar encoding and decoding\"\r\n  (encode-pchar \"google-oauth2|116635422485042503270\")\r\n  := \"google-oauth2%7C116635422485042503270\"\r\n\r\n  (decode-pchar \"google-oauth2%7C116635422485042503270\")\r\n  := \"google-oauth2|116635422485042503270\"\r\n\r\n  \"non-ascii characters\"\r\n  (encode-pchar \"!$&'[]()*+,;=|\") := \"!$&'%5B%5D()*+,;=%7C\"\r\n  (decode-pchar \"!$&'%5B%5D()*+,;=%7C\") := \"!$&'[]()*+,;=|\"\r\n\r\n  \"bijection\"\r\n  ((comp decode-pchar encode-pchar) \"google-oauth2|116635422485042503270\")\r\n  := \"google-oauth2|116635422485042503270\"\r\n\r\n  ;\"unicode\" ; broken, not sure why\r\n  ;(encode-rfc3986-pchar \"\uc704\ud0a4\ubc31\uacfc:\ub300\ubb38\") := \"%4%4%1%C:%0%8\"\r\n  ;(decode-rfc3986-pchar \"%4%4%1%C:%0%8\") := \"\uc704\ud0a4\ubc31\uacfc:\ub300\ubb38\"\r\n  ;((comp decode-rfc3986-pchar encode-rfc3986-pchar) \"\uc704\ud0a4\ubc31\uacfc:\ub300\ubb38\")\r\n  )\r\n"],"x_google_ignoreList":[0]}